var admin_index={};var taskId;$(document).ready(function(){loadMenu()});function loadMenu(){var a=(window.location.hash,""),b=0,c=0,d=$("#centerFrame"),timer=null,clickAble=true;d.tabs({border:!1,fit:!0,onAdd:function(){$.messager.progress("close")},onUpdate:function(){$.messager.progress("close")},onContextMenu:function(a,b){if(b=="首页"){return false};parseHeaderBaseContextMenuItems("centerFrame",a,b)}}),ajaxRequest({url:"/resource/menu",success:function(d){d.menu&&($("#accordion").empty().html('<ul class="headerLeftNav"></ul>'),$.each($(d.menu),function(index,item){if(void 0!=item.title){var id='panel'+index;$('#accordion').accordion('add',{id:id,title:item.title,iconCls:filterIcon(item.title),selected:false,width:'100%'});var p=$('<div></div>').appendTo("#"+id);p.tree({data:item.children,checkbox:false,onClick:function(node){if(clickAble){clickAble=false;var isLeaf=$(this).tree('isLeaf',node.target);if(isLeaf){addTabs(BasePath+node.url,node.text,node.iconCls)};clearTimeout(timer);timer=setTimeout(function(){clickAble=true},300)}},onDblClick:function(){return false},loadFilter:function(data,parent){var as=JSON.stringify(data);return JSON.parse(as.replace(/"title":/gm,'"text":'))},onLoadSuccess:function(){$('#accordion .panel .tree').unbind('mouseover mouseout')}})}}),$("#treeMenusData").data(treeMenusData))}})};function filterIcon(title){var icon='';switch(title){case'市场管理':icon='iconAws-star';break;case'报表管理':icon='iconAws-signal';break;case'其它船管理':icon='iconAws-star-empty';break;case'航线管理':icon='iconAws-sitemap';break;case'结算管理1':icon='iconAws-legal';break;case'运价管理':icon='iconAws-bar-chart';break;case'集装箱管理':icon='iconAws-cogs';break;case'集装箱管理':icon='iconAws-briefcase';break;case'订单管理':icon='iconAws-desktop';break;case'商务管理':icon='iconAws-users';break;case'结算管理':icon='iconAws-money';break;case'收入管理':icon='iconAws-credit-card';break;case'成本管理':icon='iconAws-dashboard';break;case'资金管理':icon='iconAws-money';break;case'发票管理':icon='iconAws-file-alt';break;case'系统设置':icon='iconAws-wrench';break;default:icon='iconAws-cog'};return icon};function addTabs(a,b,c,d){admin_index.addTabsForPower(a,b,c,d)};function showUpdatePass(){$("#dlgUpdatePassword").show().dialog({closed:!1,modal:!0}).dialog("open");$('#fmPassword').form('clear').form('reset').form('enableValidation')};updatePassword=function(){var validate=$("#fmPassword").form('validate');if(!validate){return};var data=$('#fmPassword').serializeJson();ajaxRequest({url:'/updatePassword',data:data,message:null,success:function(){$('#dlgUpdatePassword').dialog('close');$.messager.alert('提示','密码已修改，请重新登录','',function(){window.location.href="/toLogout"})}})};function showUserInfo(){if(userInfo.type==1){$("#dlgInitUser").show().dialog({closed:!1,modal:!0}).dialog("open");$('#fm_initUser').form('clear').form('reset').form('load',userInfo)}else if(userInfo.type==2){$("#dlgSystemUser").show().dialog({closed:!1,modal:!0}).dialog("open");ajaxRequest({url:'/systemUser/getById',data:{id:userInfo.id},success:function(data){$('#fm_systemUser').form('clear').form('reset').form('load',data.user)}})}};function loadLeftTreeData(a,b,c){var d="panel0",e=$("#treeMenusData").data()[a],f=!0,g=null,h=e.children[b].children[c],i=null,j=null;$($("#cc").layout("panel","west")).is(":hidden")&&$("#cc").layout("expand","west");try{$("#accordion").accordion("remove",0)}catch(k){};$("#accordion").accordion("add",{id:d,title:e.title,iconCls:e.iconCls,selected:!0});var l=$("<div></div>").appendTo("#"+d);l.tree({data:e.children,checkbox:!1,onClick:function(a){if(f){f=!1;var b=$(this).tree("isLeaf",a.target);b&&addTabs(BasePath+a.url,a.title,a.iconCls),clearTimeout(g),g=setTimeout(function(){f=!0},300)}},onDblClick:function(){return!1},onLoadSuccess:function(){clearTimeout(i),i=setTimeout(function(){j=l.tree("getRoots")[b].children[c].domId,l.tree("select",$("#"+j)),addTabs(BasePath+h.url,h.title,h.iconCls)},500)}})};admin_index.addTabs=function(){var a=$("#centerFrame");a.tabs("add",{title:"首页",fit:!0,content:'<img src="/resources/css/images/welcome1.jpg?v=2" style="width:100%;height:100%"/>'})};admin_index.closeTabs=function(a){var b=$("#centerFrame");b.tabs("close",a)};admin_index.addTabsForPower=function(a,b,c,d){var e='<iframe src="'+a+'" frameborder="0" border="0" marginwidth="0" marginheight="0" scrolling="yes" width="100%" height="100%" title="'+b+'"></iframe>',f=$("#centerFrame");var outWidth=$(window).outerWidth();if(outWidth<=1280){$('#westRegion').parent().hide()};f.tabs("exists",b)?f.tabs("select",b):(f.tabs("add",{title:b,content:e,iconCls:c,closable:!0}),f.tabs("loading","数据加载中...")),d&&0==$('iframe[title="'+b+'"]').contents().find("body").html().length?$('iframe[title="'+b+'"]').load(function(){d(this)}):d&&0!=$('iframe[title="'+b+'"]').contents().find("body").html().length&&d($('iframe[title="'+b+'"]'))};var maxTab=!1;var treeMenusData={};function judgeWidth(){var outWidth=$(window).outerWidth();if(outWidth<=1280){$('#cc').layout('collapse','west');$('.panel.layout-expand.layout-expand-west .panel-header').hide();$('.panel.layout-expand.layout-expand-west').unbind('hover').bind('mouseenter.mouseWest',function(){$(this).click()});$('#cc').on('mouseleave.westMouseleave','.panel.layout-panel.layout-panel-west',function(){$('#cc').layout('collapse','west')})}else{$('#cc').layout('expand','west');$('.panel.layout-expand.layout-expand-west').unbind('mouseenter.mouseWest');$('#cc').off('mouseleave.westMouseleave','.panel.layout-panel.layout-panel-west')}};$(function(){admin_index.addTabs();judgeWidth();var jFlag=null;$(window).resize(function(){clearTimeout(jFlag);jFlag=setTimeout(judgeWidth,500)});window.history.forward(1);$("#accordion").on("mouseenter",".headerLeftNavTit",function(){var a=$(".headerLeftNavMenus[data-menusTitle = "+$(this).attr("data-navTitle")+"]");a.show();var b=0,c=$(this).offset().top,d=$(this).offset().left,e=$(window).height(),f=$(this).outerHeight(),g=a.outerHeight();b=c+g>e?c-g+f:c,0>b&&(b=0),a.css({left:d+$(this).outerWidth()-2,top:b});$(this).parent().addClass("active").siblings().removeClass("active")}).on("mouseleave",".headerLeftNavTit",function(a){$(".headerLeftNavMenus[data-menusTitle = "+$(this).attr("data-navTitle")+"]").hide(),$(this).parent().removeClass("active")});$("body").on("click",".headerLeftNavMenus a",function(a){a.preventDefault(),$(this).parents(".headerLeftNavMenus").hide(),addTabs(BasePath+$(this).attr("href"),$(this).text(),""),$(".headerLeftNavMenus a").removeClass("active"),$(this).addClass("active"),$("#accordion>ul>li").removeClass("cur");var b=$(this).attr("data-parent");setTimeout(function(){$("[data-li="+b+"]").addClass("cur")},1)})});function refreshDailyBoat(){f=$("#centerFrame");var flag=f.tabs("exists",'每日船舶动态');if(flag){var dailyBoat=f.tabs('getTab','每日船舶动态');var title='每日船舶动态';var mycontent='<iframe src="'+$(dailyBoat).find('iframe').attr('src')+'" frameborder="0" border="0" marginwidth="0" marginheight="0" scrolling="yes" width="100%" height="100%" title="'+title+'"></iframe>';$("#centerFrame").tabs('update',{tab:dailyBoat,options:{title:title,content:mycontent}})}};function refreshPortManage(){f=$("#centerFrame");var flag=f.tabs("exists",'港口管理');if(flag){var dailyBoat=f.tabs('getTab','港口管理');var title='港口管理';var mycontent='<iframe src="'+$(dailyBoat).find('iframe').attr('src')+'" frameborder="0" border="0" marginwidth="0" marginheight="0" scrolling="yes" width="100%" height="100%" title="'+title+'"></iframe>';$("#centerFrame").tabs('update',{tab:dailyBoat,options:{title:title,content:mycontent}})}};var layouCollapseTarget=function(_type){var outWidth=$(window).outerWidth();if(outWidth<=1280&&_type=='expand'){$('#cc').layout('collapse','west')}else{$('#cc').layout(_type,'west')};$('#cc').layout(_type,'north')};var tStatus='expand',indexBaseWidth=$(window).width()<=1280?$(window).width()-29:$(window).width()-181,indexBaseHeight=$(window).height()-70;$(function(){$(window.top).resize(function(){if($(window).width()<=1280){indexBaseWidth=$(window).width()-29}else{indexBaseWidth=$(window).width()-181};indexBaseHeight=$(window).height()-70;$('iframe:not([title="船舶配载实录"])').width(indexBaseWidth).height(indexBaseHeight)})});var indexTabsOnselect=function(t){var p=$("#cc").layout("panel","north")[0].clientHeight;$('iframe:not([title="船舶配载实录"])').width(indexBaseWidth).height(indexBaseHeight);if(t=='船舶配载实录'){var _v=$('iframe[title="船舶配载实录"]').contents().find("#tabsStatus").val();_v=_v?_v:'expand';if(p>0&&_v=='collapse'){layouCollapseTarget('collapse')};if(p==0&&_v=='expand'){layouCollapseTarget('expand')}}else{if(p==0){layouCollapseTarget('expand')}}};$(function(){ajaxRequest({url:"/box/abnormal/getCount",message:null,success:function(res){if(res.rows>0){$.messager.defaults={ok:"前往",cancel:"关闭"};$.messager.confirm("箱位报告提示","您有未确认的箱位异常报告"+res.rows+"份，请前往查看",function(data){if(!data){return};addTabs(BasePath+"/box/abnormal/toList","箱位异常报告","")})}}})});